<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Clinical Game ‚Äî Mariana (Anorexia)</title>
<style>
  :root{
    --bg:#f5f7fb;
    --card:#ffffff;
    --accent:#3aa76d;
    --accent-2:#6fd89a;
    --muted:#96a0b5;
    --locked:#bcc5d3;
    --gold:#FFD700;
    --orange:#FF8C00;
    --hospital-blue:#4A90E2;
    --hospital-teal:#2C7B9E;
    --medical-green:#3aa76d;
  }
  *{ box-sizing:border-box; }
  
  /* Made body full-screen and responsive */
  body{
    margin:0;
    padding:0;
    font-family:'Inter', system-ui, -apple-system, Arial, sans-serif;
    background:linear-gradient(135deg, #E8F4F8 0%, #D1E9F6 100%);
    color:#233;
    -webkit-font-smoothing:antialiased;
    overflow-x:hidden;
    width:100vw;
    min-height:100vh;
  }
  
  /* Made wrap container full-screen and responsive */
  .wrap{
    width:100%;
    height:100vh;
    margin:0;
    padding:0;
    display:flex;
    flex-direction:column;
  }
  
  /* TOP BAR - responsive */
  .top-bar{
    background:linear-gradient(135deg, #3aa76d, #2d8a5a);
    color:white;
    padding:clamp(12px, 2vw, 18px) clamp(16px, 3vw, 28px);
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 6px 24px rgba(0,0,0,0.18);
    position:relative;
    overflow:hidden;
    flex-shrink:0;
  }
  .top-bar::before{
    content:'';
    position:absolute;
    top:-50%;
    right:-10%;
    width:220px;
    height:220px;
    background:radial-gradient(circle, rgba(255,255,255,0.15), transparent);
    border-radius:50%;
    animation:pulse 4s ease-in-out infinite;
  }
  @keyframes pulse{
    0%, 100%{ transform:scale(1); opacity:0.5; }
    50%{ transform:scale(1.2); opacity:0.8; }
  }
  .player-info{
    display:flex;
    align-items:center;
    gap:clamp(8px, 1.5vw, 14px);
    z-index:2;
  }
  .player-avatar{
    width:clamp(36px, 6vw, 48px);
    height:clamp(36px, 6vw, 48px);
    border-radius:50%;
    background:linear-gradient(135deg, #4A90E2, #2C7B9E);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(20px, 3vw, 26px);
    border:3px solid white;
    box-shadow:0 6px 16px rgba(0,0,0,0.25);
  }
  .player-name{
    font-weight:700;
    font-size:clamp(15px, 2vw, 19px);
    text-shadow:0 2px 4px rgba(0,0,0,0.2);
  }
  .game-stats{
    display:flex;
    align-items:center;
    gap:clamp(8px, 1.5vw, 20px);
    flex-wrap:wrap;
  }
  .lives-display, .timer-display, .score-display{
    display:flex;
    align-items:center;
    gap:6px;
    background:rgba(255,255,255,0.3);
    padding:clamp(6px, 1vw, 10px) clamp(10px, 1.5vw, 18px);
    border-radius:24px;
    font-weight:700;
    font-size:clamp(14px, 1.8vw, 17px);
    backdrop-filter:blur(10px);
    border:2px solid rgba(255,255,255,0.4);
  }
  .heart-icon, .star-icon{
    font-size:clamp(18px, 2.2vw, 22px);
  }
  .heart-icon{
    animation:heartPulse 1.5s ease-in-out infinite;
  }
  @keyframes heartPulse{
    0%, 100%{ transform:scale(1); }
    50%{ transform:scale(1.2); }
  }
  .star-icon{
    animation:starRotate 4s linear infinite;
  }
  @keyframes starRotate{
    0%, 100%{ transform:rotate(0deg) scale(1); }
    50%{ transform:rotate(360deg) scale(1.25); }
  }
  .clock-icon{
    font-size:clamp(16px, 2vw, 20px);
  }
  .info-btn{
    width:clamp(36px, 5vw, 44px);
    height:clamp(36px, 5vw, 44px);
    border-radius:50%;
    background:rgba(255,255,255,0.35);
    border:3px solid white;
    color:white;
    font-size:clamp(20px, 2.5vw, 24px);
    font-weight:700;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    transition:all .3s cubic-bezier(.4,0,.2,1);
    z-index:2;
  }
  .info-btn:hover{
    background:rgba(255,255,255,0.6);
    transform:scale(1.2) rotate(20deg);
    box-shadow:0 6px 20px rgba(0,0,0,0.3);
  }
  
  /* Made game map full-height to cover the entire viewport and remove bottom gap */
  .game-map{
    position:relative;
    background:
      linear-gradient(180deg, rgba(232,244,248,0.92) 0%, rgba(209,233,246,0.92) 100%),
      url('f.png');
    background-size:cover;
    background-position:center center;
    background-repeat:no-repeat;
    background-blend-mode:overlay;
    min-height:calc(100vh - 90px);
    height:calc(100vh - 90px);
    padding:clamp(30px, 4vw, 50px) clamp(15px, 2.5vw, 30px);
    overflow:hidden;
    display:flex;
    flex-direction:column;
  }
  .game-map::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background-image:
      radial-gradient(circle at 20% 30%, rgba(74,144,226,0.08) 0%, transparent 50%),
      radial-gradient(circle at 80% 70%, rgba(58,167,109,0.08) 0%, transparent 50%);
    pointer-events:none;
  }
  
  /* Removed all floating decoration styles */
  
  /* SVG curved path positioned along the map */
  .path-visual{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    z-index:1;
    pointer-events:none;
  }
  .curved-path{
    fill:none;
    stroke:#b8d4e0;
    stroke-width:50;
    stroke-linecap:round;
    stroke-linejoin:round;
    filter:drop-shadow(0 6px 12px rgba(0,0,0,0.15));
  }
  .path-border{
    fill:none;
    stroke:#8eb8cf;
    stroke-width:53;
    stroke-linecap:round;
    stroke-linejoin:round;
    opacity:0.5;
  }
  
  /* Doctor Chapatin moves along the curved path */
  .doctor-character{
    position:absolute;
    /* Use top positioning to place character near nodes instead of fixed bottom */
    top:50%;
    transform:translateY(-50%);
    left:5%;
    width:clamp(70px, 10vw, 100px);
    height:auto;
    z-index:20;
    transition:all 0.8s cubic-bezier(.4,0,.2,1);
    filter:drop-shadow(0 4px 12px rgba(0,0,0,0.2));
    pointer-events:none;
  }
  .doctor-character img{
    width:100%;
    height:auto;
    display:block;
  }
  
  /* Progress bar - responsive */
  .progress-container{
    position:relative;
    width:100%;
    max-width:650px;
    margin:0 auto 35px;
    z-index:10;
  }
  .progress-bar{
    height:32px;
    background:rgba(255,255,255,0.6);
    border-radius:24px;
    overflow:hidden;
    box-shadow:0 6px 16px rgba(0,0,0,0.15);
    position:relative;
    border:3px solid rgba(58,167,109,0.35);
    backdrop-filter:blur(10px);
  }
  .progress-fill{
    height:100%;
    background:linear-gradient(90deg, #3aa76d, #4ade80, #3aa76d);
    background-size:200% 100%;
    animation:gradientShift 3s ease infinite;
    border-radius:24px;
    transition:width .7s cubic-bezier(.4,0,.2,1);
    display:flex;
    align-items:center;
    justify-content:flex-end;
    padding-right:12px;
    font-weight:700;
    color:white;
    font-size:15px;
    position:relative;
    overflow:hidden;
    box-shadow:0 0 20px rgba(58,167,109,0.6);
  }
  @keyframes gradientShift{
    0%, 100%{ background-position:0% 50%; }
    50%{ background-position:100% 50%; }
  }
  .progress-fill::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    animation:shimmer 2s infinite;
  }
  @keyframes shimmer{
    0%{ transform:translateX(-100%); }
    100%{ transform:translateX(100%); }
  }
  
  /* Nodes positioned absolutely along curved path */
  .nodes-container{
    position:relative;
    z-index:10;
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    align-items:center;
    gap:clamp(15px, 2.5vw, 25px);
    max-width:1100px;
    margin:auto;
    padding:clamp(20px, 3vw, 40px);
    flex:1;
  }
  
  /* Level nodes responsive and positioned on path */
  .level-node{
    position:relative;
    width:clamp(85px, 11vw, 110px);
    height:clamp(85px, 11vw, 110px);
    border-radius:50%;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    font-weight:700;
    font-size:clamp(20px, 2.5vw, 26px);
    cursor:pointer;
    transition:all .45s cubic-bezier(.4,0,.2,1);
    box-shadow:0 10px 25px rgba(0,0,0,0.2);
  }
  .level-node.locked{
    background:linear-gradient(135deg, #cbd5e1, #94a3b8);
    color:#64748b;
    cursor:not-allowed;
    position:relative;
  }
  .level-node.locked::after{
    content:'üîí';
    position:absolute;
    top:-12px;
    right:-12px;
    font-size:clamp(24px, 3vw, 30px);
    filter:drop-shadow(0 3px 6px rgba(0,0,0,0.35));
  }
  .level-node.unlocked{
    background:linear-gradient(135deg, #4A90E2, #2C7B9E);
    color:#fff;
    animation:pulseGlow 2.5s ease-in-out infinite;
    cursor:pointer;
    border:4px solid rgba(255,255,255,0.3);
  }
  .level-node.unlocked:hover{
    transform:translateY(-15px) scale(1.2) rotate(8deg);
    box-shadow:0 20px 40px rgba(74,144,226,0.6);
  }
  @keyframes pulseGlow{
    0%, 100%{ 
      transform:scale(1);
      box-shadow:0 10px 25px rgba(74,144,226,0.5), 0 0 30px rgba(74,144,226,0.3);
    }
    50%{ 
      transform:scale(1.12);
      box-shadow:0 15px 35px rgba(74,144,226,0.7), 0 0 50px rgba(74,144,226,0.5);
    }
  }
  .level-node.completed{
    background:linear-gradient(135deg, var(--accent), var(--accent-2));
    color:white;
    animation:completeBounce .7s ease;
    border:4px solid rgba(255,255,255,0.5);
  }
  @keyframes completeBounce{
    0%{ transform:scale(1) rotate(0deg); }
    50%{ transform:scale(1.35) rotate(15deg); }
    100%{ transform:scale(1) rotate(0deg); }
  }
  .level-node.completed::after{
    content:'‚úì';
    position:absolute;
    top:-14px;
    right:-14px;
    background:#fff;
    color:var(--accent);
    width:clamp(30px, 4vw, 36px);
    height:clamp(30px, 4vw, 36px);
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:clamp(18px, 2.5vw, 22px);
    font-weight:700;
    box-shadow:0 6px 16px rgba(0,0,0,0.25);
    animation:checkPop .6s ease;
  }
  @keyframes checkPop{
    0%{ transform:scale(0) rotate(-200deg); }
    50%{ transform:scale(1.4) rotate(15deg); }
    100%{ transform:scale(1) rotate(0); }
  }
  .level-label{
    font-size:clamp(11px, 1.4vw, 13px);
    margin-top:6px;
    opacity:0.95;
    font-weight:600;
  }
  
  /* Enhanced modal with glassmorphism and advanced animations */
  .modal-overlay{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.75);
    backdrop-filter:blur(12px);
    z-index:1000;
    align-items:center;
    justify-content:center;
    animation:fadeIn .45s ease;
  }
  .modal-overlay.active{ display:flex; }
  @keyframes fadeIn{
    from{ opacity:0; }
    to{ opacity:1; }
  }
  .modal-box{
    background:linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius:28px;
    padding:clamp(24px, 4vw, 36px);
    max-width:650px;
    width:94%;
    box-shadow:0 30px 90px rgba(0,0,0,0.5);
    animation:modalSlideUp .6s cubic-bezier(.4,0,.2,1);
    position:relative;
    overflow:hidden;
    border:3px solid rgba(74,144,226,0.2);
  }
  .modal-box::before{
    content:'';
    position:absolute;
    top:-60%;
    right:-25%;
    width:350px;
    height:350px;
    background:radial-gradient(circle, rgba(74,144,226,0.18), transparent);
    border-radius:50%;
    animation:rotate 20s linear infinite;
  }
  @keyframes rotate{
    from{ transform:rotate(0deg); }
    to{ transform:rotate(360deg); }
  }
  @keyframes modalSlideUp{
    from{ transform:translateY(120px) scale(0.85); opacity:0; }
    to{ transform:translateY(0) scale(1); opacity:1; }
  }
  .modal-header{
    font-size:clamp(20px, 2.5vw, 24px);
    font-weight:700;
    color:#1a2744;
    margin:0 0 24px 0;
    position:relative;
    z-index:2;
    text-shadow:0 2px 6px rgba(0,0,0,0.08);
  }
  .question-number{
    display:inline-block;
    background:linear-gradient(135deg, #4A90E2, #2C7B9E);
    color:white;
    padding:6px 16px;
    border-radius:14px;
    font-size:clamp(13px, 1.6vw, 15px);
    margin-right:10px;
    box-shadow:0 4px 12px rgba(74,144,226,0.35);
  }
  .modal-options{
    display:flex;
    flex-direction:column;
    gap:16px;
    margin-top:28px;
    position:relative;
    z-index:2;
  }
  /* Enhanced option buttons with ripple effect and 3D transform */
  .option-btn{
    display:flex;
    gap:16px;
    align-items:center;
    padding:clamp(14px, 2vw, 18px) clamp(16px, 2.5vw, 20px);
    background:white;
    border:3px solid #e5e7eb;
    border-radius:18px;
    cursor:pointer;
    transition:all .35s cubic-bezier(.4,0,.2,1);
    position:relative;
    overflow:hidden;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
  }
  .option-btn::before{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    border-radius:50%;
    background:rgba(74,144,226,0.15);
    transform:translate(-50%, -50%);
    transition:width .7s, height .7s;
  }
  .option-btn:hover{
    transform:translateX(12px) translateY(-3px);
    box-shadow:0 15px 35px rgba(0,0,0,0.15);
    border-color:#cbd5e1;
  }
  .option-btn:hover::before{
    width:400px;
    height:400px;
  }
  .option-btn:active{
    transform:scale(0.96);
  }
  .opt-letter{
    width:clamp(40px, 5vw, 48px);
    height:clamp(40px, 5vw, 48px);
    min-width:clamp(40px, 5vw, 48px);
    border-radius:14px;
    background:linear-gradient(135deg, #dbeafe, #bfdbfe);
    display:flex;
    align-items:center;
    justify-content:center;
    color:#1e40af;
    font-weight:700;
    font-size:clamp(18px, 2.2vw, 22px);
    box-shadow:0 6px 12px rgba(0,0,0,0.1);
    z-index:2;
  }
  .opt-text{
    color:#1f2937;
    font-size:clamp(15px, 1.8vw, 17px);
    font-weight:500;
    z-index:2;
  }
  /* Enhanced feedback animations with more dramatic effects */
  .option-btn.correct{
    animation:correctShake .7s ease;
    border-color:#4ade80 !important;
    background:linear-gradient(135deg, #f0fdf4, #dcfce7) !important;
    box-shadow:0 10px 30px rgba(74,222,128,0.4) !important;
  }
  .option-btn.correct .opt-letter{
    background:linear-gradient(135deg, #4ade80, #22c55e);
    color:white;
    animation:letterPop .5s ease;
  }
  @keyframes letterPop{
    0%{ transform:scale(1); }
    50%{ transform:scale(1.3) rotate(10deg); }
    100%{ transform:scale(1); }
  }
  @keyframes correctShake{
    0%, 100%{ transform:translateX(0) rotate(0deg); }
    20%{ transform:translateX(-10px) rotate(-3deg) scale(1.05); }
    40%{ transform:translateX(10px) rotate(3deg) scale(1.05); }
    60%{ transform:translateX(-10px) rotate(-3deg) scale(1.05); }
    80%{ transform:translateX(10px) rotate(3deg) scale(1.05); }
  }
  .option-btn.incorrect{
    animation:incorrectShake .7s ease;
    border-color:#f87171 !important;
    background:linear-gradient(135deg, #fef2f2, #fee2e2) !important;
    box-shadow:0 10px 30px rgba(248,113,113,0.4) !important;
  }
  .option-btn.incorrect .opt-letter{
    background:linear-gradient(135deg, #f87171, #ef4444);
    color:white;
    animation:letterShake .5s ease;
  }
  @keyframes letterShake{
    0%, 100%{ transform:translateX(0); }
    25%{ transform:translateX(-5px); }
    75%{ transform:translateX(5px); }
  }
  @keyframes incorrectShake{
    0%, 100%{ transform:translateX(0) rotate(0deg); }
    15%{ transform:translateX(-12px) rotate(-4deg); }
    30%{ transform:translateX(12px) rotate(4deg); }
    45%{ transform:translateX(-12px) rotate(-4deg); }
    60%{ transform:translateX(12px) rotate(4deg); }
    75%{ transform:translateX(-8px) rotate(-2deg); }
  }
  /* Particles effect */
  .particle{
    position:fixed;
    pointer-events:none;
    font-size:clamp(22px, 3vw, 28px);
    animation:particleFloat 1.8s ease-out forwards;
    z-index:9999;
  }
  @keyframes particleFloat{
    0%{ transform:translateY(0) scale(0) rotate(0deg); opacity:1; }
    100%{ transform:translateY(-180px) scale(1.8) rotate(360deg); opacity:0; }
  }
  /* INFO MODAL */
  .info-modal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.75);
    backdrop-filter:blur(12px);
    z-index:2000;
    align-items:center;
    justify-content:center;
  }
  .info-modal.active{ display:flex; }
  .info-content{
    background:white;
    border-radius:28px;
    padding:clamp(28px, 4vw, 40px);
    max-width:700px;
    width:94%;
    max-height:88vh;
    overflow-y:auto;
    box-shadow:0 30px 90px rgba(0,0,0,0.5);
    animation:modalSlideUp .6s ease;
  }
  .info-content h3{
    margin:0 0 24px 0;
    color:#1a2744;
    font-size:clamp(22px, 2.8vw, 26px);
  }
  .info-content p{
    line-height:1.75;
    color:#374151;
    margin-bottom:14px;
    font-size:clamp(14px, 1.6vw, 16px);
  }
  .close-info{
    display:inline-block;
    margin-top:28px;
    padding:14px 32px;
    background:linear-gradient(135deg, var(--accent), var(--accent-2));
    color:white;
    border-radius:14px;
    cursor:pointer;
    font-weight:700;
    transition:all .35s;
    box-shadow:0 6px 16px rgba(58,167,109,0.35);
  }
  .close-info:hover{
    transform:translateY(-4px);
    box-shadow:0 10px 25px rgba(58,167,109,0.5);
  }
  
  /* Added alert modal styles for wrong answer feedback */
  .alert-modal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.85);
    backdrop-filter:blur(15px);
    z-index:3000;
    align-items:center;
    justify-content:center;
  }
  .alert-modal.active{ display:flex; }
  .alert-box{
    background:linear-gradient(135deg, #ffffff 0%, #fef2f2 100%);
    border-radius:32px;
    padding:clamp(35px, 5vw, 50px);
    max-width:550px;
    width:90%;
    text-align:center;
    box-shadow:0 35px 100px rgba(0,0,0,0.6);
    animation:alertPop .5s cubic-bezier(.68,-0.55,.265,1.55);
    border:4px solid #f87171;
    position:relative;
    overflow:hidden;
  }
  @keyframes alertPop{
    0%{ transform:scale(0.3) rotate(-15deg); opacity:0; }
    50%{ transform:scale(1.1) rotate(5deg); opacity:1; }
    100%{ transform:scale(1) rotate(0deg); }
  }
  .alert-box::before{
    content:'';
    position:absolute;
    top:-50%;
    left:-50%;
    width:200%;
    height:200%;
    background:radial-gradient(circle, rgba(248,113,113,0.15), transparent);
    animation:pulse 3s ease infinite;
  }
  .alert-icon{
    font-size:clamp(80px, 12vw, 120px);
    margin-bottom:20px;
    animation:iconShake 0.8s ease;
    filter:drop-shadow(0 10px 30px rgba(248,113,113,0.4));
  }
  @keyframes iconShake{
    0%, 100%{ transform:rotate(0deg) scale(1); }
    25%{ transform:rotate(-15deg) scale(1.1); }
    50%{ transform:rotate(15deg) scale(1.1); }
    75%{ transform:rotate(-15deg) scale(1.1); }
  }
  .alert-title{
    font-size:clamp(28px, 4vw, 38px);
    font-weight:900;
    color:#dc2626;
    margin:0 0 16px 0;
    text-shadow:0 4px 12px rgba(220,38,38,0.3);
  }
  .alert-message{
    font-size:clamp(16px, 2.2vw, 20px);
    color:#991b1b;
    margin:0 0 12px 0;
    font-weight:600;
    line-height:1.6;
  }
  .lives-remaining{
    font-size:clamp(22px, 3vw, 28px);
    margin:20px 0;
    color:#dc2626;
    font-weight:700;
  }
  .alert-button{
    margin-top:30px;
    padding:clamp(14px, 2vw, 18px) clamp(35px, 5vw, 50px);
    background:linear-gradient(135deg, #ef4444, #dc2626);
    color:white;
    border:none;
    border-radius:18px;
    font-weight:900;
    font-size:clamp(16px, 2.2vw, 20px);
    cursor:pointer;
    transition:all .35s cubic-bezier(.4,0,.2,1);
    box-shadow:0 10px 30px rgba(220,38,38,0.4);
    position:relative;
    overflow:hidden;
  }
  .alert-button::before{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    border-radius:50%;
    background:rgba(255,255,255,0.3);
    transform:translate(-50%, -50%);
    transition:width .5s, height .5s;
  }
  .alert-button:hover{
    transform:translateY(-5px) scale(1.05);
    box-shadow:0 15px 45px rgba(220,38,38,0.6);
  }
  .alert-button:hover::before{
    width:400px;
    height:400px;
  }
  /* Enhanced start screen with gender selection */
  .start-screen{
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    background:linear-gradient(135deg, #1e3a8a 0%, #3b82f6 25%, #06b6d4 50%, #10b981 75%, #059669 100%);
    background-size:300% 300%;
    animation:gradientMove 12s ease infinite;
    overflow:hidden;
    z-index:10000;
    padding:20px;
  }
  @keyframes gradientMove{
    0%{ background-position:0% 50%; }
    50%{ background-position:100% 50%; }
    100%{ background-position:0% 50%; }
  }
  .start-screen::before{
    content:'';
    position:absolute;
    top:0;
    left:0;
    right:0;
    bottom:0;
    background:
      radial-gradient(circle at 20% 80%, rgba(255,255,255,0.15) 0%, transparent 40%),
      radial-gradient(circle at 80% 20%, rgba(255,255,255,0.15) 0%, transparent 40%),
      radial-gradient(circle at 40% 40%, rgba(255,255,255,0.08) 0%, transparent 50%);
    animation:float 8s ease-in-out infinite;
  }
  @keyframes float{
    0%, 100%{ transform:translateY(0); }
    50%{ transform:translateY(-20px); }
  }
  .start-content{
    position:relative;
    z-index:2;
    text-align:center;
    padding:clamp(40px, 6vw, 60px) clamp(20px, 4vw, 30px);
    background:rgba(255,255,255,0.15);
    backdrop-filter:blur(20px);
    border-radius:40px;
    border:3px solid rgba(255,255,255,0.3);
    box-shadow:0 30px 80px rgba(0,0,0,0.3);
    max-width:700px;
    width:95%;
    animation:contentFloat 1.2s ease;
  }
  @keyframes contentFloat{
    from{ transform:translateY(60px) scale(0.9); opacity:0; }
    to{ transform:translateY(0) scale(1); opacity:1; }
  }
  .start-screen h1{
    font-size:clamp(32px, 6vw, 52px);
    margin:0 0 20px 0;
    color:white;
    text-shadow:0 4px 20px rgba(0,0,0,0.4);
    font-weight:900;
    letter-spacing:1px;
  }
  .start-screen .emoji-header{
    font-size:clamp(60px, 10vw, 100px);
    margin-bottom:20px;
    animation:bounceRotate 3s infinite;
    filter:drop-shadow(0 10px 25px rgba(0,0,0,0.4));
  }
  @keyframes bounceRotate{
    0%, 100%{ transform:translateY(0) rotate(0deg) scale(1); }
    25%{ transform:translateY(-20px) rotate(-15deg) scale(1.1); }
    50%{ transform:translateY(0) rotate(0deg) scale(1); }
    75%{ transform:translateY(-15px) rotate(15deg) scale(1.1); }
  }
  .start-screen .subtitle{
    font-size:clamp(18px, 2.5vw, 24px);
    color:rgba(255,255,255,0.95);
    margin:0 0 12px 0;
    font-weight:700;
    text-shadow:0 2px 10px rgba(0,0,0,0.3);
  }
  .start-screen p{
    color:rgba(255,255,255,0.9);
    margin:0 0 35px 0;
    line-height:1.8;
    font-size:clamp(15px, 1.8vw, 18px);
    text-shadow:0 2px 8px rgba(0,0,0,0.2);
  }
  
  /* Added gender selection with radio buttons */
  .gender-selection{
    display:flex;
    gap:20px;
    justify-content:center;
    margin-bottom:25px;
  }
  .gender-option{
    display:flex;
    align-items:center;
    gap:8px;
    background:rgba(255,255,255,0.2);
    padding:12px 24px;
    border-radius:16px;
    cursor:pointer;
    transition:all .3s;
    border:3px solid transparent;
  }
  .gender-option:hover{
    background:rgba(255,255,255,0.3);
    transform:scale(1.05);
  }
  .gender-option input[type="radio"]{
    width:20px;
    height:20px;
    cursor:pointer;
  }
  .gender-option.selected{
    background:rgba(255,255,255,0.4);
    border-color:rgba(255,255,255,0.8);
    box-shadow:0 8px 20px rgba(0,0,0,0.2);
  }
  .gender-option label{
    color:white;
    font-size:clamp(16px, 2vw, 18px);
    font-weight:700;
    cursor:pointer;
    text-shadow:0 2px 8px rgba(0,0,0,0.2);
  }
  
  .start-screen input[type="text"]{
    width:100%;
    max-width:450px;
    padding:clamp(16px, 2vw, 20px) clamp(20px, 3vw, 28px);
    border:3px solid rgba(255,255,255,0.4);
    border-radius:20px;
    font-size:clamp(16px, 1.8vw, 18px);
    margin-bottom:28px;
    transition:all .4s;
    background:rgba(255,255,255,0.95);
    backdrop-filter:blur(10px);
    box-shadow:0 8px 25px rgba(0,0,0,0.2);
  }
  .start-screen input[type="text"]:focus{
    outline:none;
    border-color:rgba(255,255,255,0.9);
    box-shadow:0 10px 40px rgba(0,0,0,0.3), 0 0 0 6px rgba(255,255,255,0.2);
    transform:scale(1.03);
  }
  .start-screen button{
    padding:clamp(18px, 2.5vw, 22px) clamp(40px, 6vw, 60px);
    background:linear-gradient(135deg, #ffffff, #f0f0f0);
    color:#1e3a8a;
    border:none;
    border-radius:20px;
    font-weight:900;
    font-size:clamp(18px, 2.2vw, 22px);
    cursor:pointer;
    transition:all .4s cubic-bezier(.4,0,.2,1);
    box-shadow:0 15px 40px rgba(0,0,0,0.35);
    position:relative;
    overflow:hidden;
  }
  .start-screen button::before{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    border-radius:50%;
    background:rgba(59,130,246,0.3);
    transform:translate(-50%, -50%);
    transition:width .6s, height .6s;
  }
  .start-screen button:hover{
    transform:translateY(-8px) scale(1.05);
    box-shadow:0 20px 60px rgba(0,0,0,0.5);
  }
  .start-screen button:hover::before{
    width:500px;
    height:500px;
  }
  .start-screen button:active{
    transform:translateY(-4px) scale(1.02);
  }
  /* Pulsing rings around emoji */
  .pulse-ring{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%);
    width:150px;
    height:150px;
    border:4px solid rgba(255,255,255,0.5);
    border-radius:50%;
    animation:ringPulse 2.5s ease-out infinite;
  }
  .pulse-ring:nth-child(2){
    animation-delay:0.5s;
  }
  .pulse-ring:nth-child(3){
    animation-delay:1s;
  }
  @keyframes ringPulse{
    0%{ transform:translate(-50%, -50%) scale(0.8); opacity:0.8; }
    100%{ transform:translate(-50%, -50%) scale(2); opacity:0; }
  }
  .emoji-container{
    position:relative;
    display:inline-block;
  }
  /* Floating medical icons in background */
  .start-decoration{
    position:absolute;
    font-size:clamp(40px, 8vw, 60px);
    opacity:0.25;
    animation:floatAround 15s ease-in-out infinite;
    pointer-events:none;
  }
  @keyframes floatAround{
    0%, 100%{ transform:translate(0, 0) rotate(0deg); opacity:0.25; }
    25%{ transform:translate(30px, -30px) rotate(90deg); opacity:0.4; }
    50%{ transform:translate(-20px, 40px) rotate(180deg); opacity:0.25; }
    75%{ transform:translate(40px, 20px) rotate(270deg); opacity:0.4; }
  }

  /* Enhanced result screen */
  .result-screen{
    display:none;
    padding:clamp(40px, 5vw, 60px) clamp(20px, 3vw, 25px);
    text-align:center;
    max-width:780px;
    margin:clamp(40px, 8vw, 70px) auto;
    background:white;
    border-radius:32px;
    box-shadow:0 25px 70px rgba(0,0,0,0.18);
    animation:modalSlideUp .7s ease;
  }
  .result-screen.active{ display:block; }
  .result-emoji{
    font-size:clamp(60px, 9vw, 90px);
    margin-bottom:24px;
    animation:resultPop 1.2s ease;
  }
  @keyframes resultPop{
    0%{ transform:scale(0) rotate(-200deg); }
    50%{ transform:scale(1.3) rotate(15deg); }
    100%{ transform:scale(1) rotate(0); }
  }
  .result-screen h2{
    font-size:clamp(28px, 4vw, 36px);
    margin:0 0 24px 0;
    color:#1a2744;
  }
  .result-screen ul{
    text-align:left;
    line-height:1.9;
    color:#374151;
    font-size:clamp(14px, 1.6vw, 16px);
  }
  .restart-btn{
    margin-top:32px;
    padding:16px 42px;
    background:linear-gradient(135deg, #3aa76d, #4A90E2);
    color:white;
    border:none;
    border-radius:16px;
    font-weight:700;
    font-size:18px;
    cursor:pointer;
    transition:all .35s;
    box-shadow:0 8px 20px rgba(58,167,109,0.35);
  }
  .restart-btn:hover{
    transform:translateY(-4px);
    box-shadow:0 12px 30px rgba(58,167,109,0.5);
  }
  
  /* Custom game over modal to replace browser alert */
  .game-over-modal{
    display:none;
    position:fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background:rgba(0,0,0,0.9);
    backdrop-filter:blur(20px);
    z-index:5000;
    align-items:center;
    justify-content:center;
  }
  .game-over-modal.active{ display:flex; }
  .game-over-box{
    background:linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    border-radius:40px;
    padding:clamp(40px, 6vw, 60px);
    max-width:600px;
    width:90%;
    text-align:center;
    box-shadow:0 40px 120px rgba(0,0,0,0.8);
    animation:gameOverPop .8s cubic-bezier(.68,-0.55,.265,1.55);
    border:5px solid #e74c3c;
    position:relative;
    overflow:hidden;
  }
  @keyframes gameOverPop{
    0%{ transform:scale(0.2) rotate(-180deg); opacity:0; }
    60%{ transform:scale(1.15) rotate(10deg); opacity:1; }
    100%{ transform:scale(1) rotate(0deg); }
  }
  .game-over-box::before{
    content:'';
    position:absolute;
    top:-100%;
    left:-100%;
    width:300%;
    height:300%;
    background:radial-gradient(circle, rgba(231,76,60,0.3), transparent);
    animation:pulse 3s ease infinite;
  }
  .game-over-icon{
    font-size:clamp(90px, 14vw, 140px);
    margin-bottom:30px;
    animation:iconFloat 2s ease-in-out infinite;
  }
  @keyframes iconFloat{
    0%, 100%{ transform:translateY(0) rotate(0deg); }
    50%{ transform:translateY(-20px) rotate(10deg); }
  }
  .game-over-title{
    font-size:clamp(32px, 5vw, 48px);
    font-weight:900;
    color:#e74c3c;
    margin:0 0 20px 0;
    text-shadow:0 6px 20px rgba(231,76,60,0.5);
    letter-spacing:2px;
  }
  .game-over-message{
    font-size:clamp(18px, 2.5vw, 24px);
    color:#ecf0f1;
    margin:0 0 15px 0;
    font-weight:600;
    line-height:1.6;
  }
  .game-over-stats{
    font-size:clamp(16px, 2.2vw, 20px);
    margin:25px 0;
    color:#bdc3c7;
    font-weight:600;
  }
  .game-over-button{
    margin-top:40px;
    padding:clamp(18px, 2.5vw, 22px) clamp(40px, 6vw, 60px);
    background:linear-gradient(135deg, #e74c3c, #c0392b);
    color:white;
    border:none;
    border-radius:20px;
    font-weight:900;
    font-size:clamp(18px, 2.5vw, 24px);
    cursor:pointer;
    transition:all .4s cubic-bezier(.4,0,.2,1);
    box-shadow:0 15px 45px rgba(231,76,60,0.5);
    position:relative;
    overflow:hidden;
    text-transform:uppercase;
    letter-spacing:1px;
  }
  .game-over-button::before{
    content:'';
    position:absolute;
    top:50%;
    left:50%;
    width:0;
    height:0;
    border-radius:50%;
    background:rgba(255,255,255,0.3);
    transform:translate(-50%, -50%);
    transition:width .6s, height .6s;
  }
  .game-over-button:hover{
    transform:translateY(-8px) scale(1.08);
    box-shadow:0 20px 60px rgba(231,76,60,0.7);
  }
  .game-over-button:hover::before{
    width:500px;
    height:500px;
  }

  /* Responsive adjustments for mobile devices */
  @media (max-width:768px){
    .top-bar{
      flex-wrap:wrap;
      gap:12px;
    }
    .game-stats{
      order:3;
      width:100%;
      justify-content:center;
    }
    .gender-selection{
      flex-direction:column;
      gap:12px;
    }
  }
  @media (max-width:600px){
    .level-node{ 
      width:clamp(70px, 15vw, 85px); 
      height:clamp(70px, 15vw, 85px); 
      font-size:clamp(18px, 3vw, 22px); 
    }
    .modal-box{ padding:clamp(20px, 4vw, 28px); }
    .doctor-character{
      width:clamp(60px, 12vw, 80px);
    }
  }
</style>
</head>
<body>

<!-- Full-screen start screen with gender selection -->
<div class="start-screen" id="startScreen">
  <!-- Floating medical decorations -->
  <div class="start-decoration" style="top:10%; left:15%; animation-delay:0s;">ü©∫</div>
  <div class="start-decoration" style="top:20%; right:20%; animation-delay:2s;">üíä</div>
  <div class="start-decoration" style="bottom:15%; left:25%; animation-delay:1s;">üíâ</div>
  <div class="start-decoration" style="bottom:25%; right:15%; animation-delay:3s;">üè•</div>
  <div class="start-decoration" style="top:50%; left:10%; animation-delay:1.5s;">üî¨</div>
  <div class="start-decoration" style="top:60%; right:10%; animation-delay:2.5s;">‚ù§Ô∏è</div>
  
  <div class="start-content">
    <div class="emoji-container">
      <div class="pulse-ring"></div>
      <div class="pulse-ring"></div>
      <div class="pulse-ring"></div>
      <div class="emoji-header">ü©∫</div>
    </div>
    <h1>Clinical Challenge</h1>
    <div class="subtitle">Journey with Doctor Chapatin</div>
    <p><strong>Help Doctor Chapatin save Mariana!</strong><br>Complete 7 random clinical challenges. Each correct answer unlocks the next level. You have 3 lives - lose them all and restart from level 1!</p>
    
    <!-- Added gender selection -->
    <div class="gender-selection">
      <div class="gender-option" id="genderMale">
        <input type="radio" name="gender" id="radioMale" value="male">
        <label for="radioMale">üë® Male</label>
      </div>
      <div class="gender-option" id="genderFemale">
        <input type="radio" name="gender" id="radioFemale" value="female">
        <label for="radioFemale">üë© Female</label>
      </div>
    </div>
    
    <input id="playerNameInput" type="text" placeholder="Enter your name (e.g., Dr. Smith)" aria-label="Player name">
    <br>
    <button id="btnStart">üöÄ Begin Adventure</button>
  </div>
</div>

<!-- GAME SCREEN (hidden initially) -->
<div class="wrap" id="gameScreen" style="display:none;">
  <!-- TOP BAR -->
  <div class="top-bar">
    <div class="player-info">
      <div class="player-avatar" id="playerAvatar">üë®‚Äç‚öïÔ∏è</div>
      <div class="player-name" id="playerNameDisplay">Player</div>
    </div>
    <div class="game-stats">
      <div class="lives-display">
        <span class="heart-icon">‚ù§Ô∏è</span>
        <span id="livesDisplay">3</span>
      </div>
      <div class="timer-display">
        <span class="clock-icon">‚è±Ô∏è</span>
        <span id="timerDisplay">00:00</span>
      </div>
      <div class="score-display">
        <span class="star-icon">‚≠ê</span>
        <span id="scoreDisplay">0/7</span>
      </div>
    </div>
    <div class="info-btn" id="infoBtnTop" title="View clinical case">i</div>
  </div>

  <!-- Full-screen game map with curved path and no floating decorations -->
  <div class="game-map">
    <!-- Progress bar at top -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width:0%;">
          <span id="progressText">0/7</span>
        </div>
      </div>
    </div>

    <!-- Doctor Chapatin character -->
    <div class="doctor-character" id="doctorCharacter">
      <img src="d1.webp" alt="Doctor Chapatin">
    </div>

    <!-- Nodes in horizontal layout -->
    <div class="nodes-container" id="nodesContainer">
      <!-- Generated dynamically -->
    </div>
  </div>
</div>

<!-- RESULT SCREEN -->
<div class="result-screen" id="resultScreen">
  <div class="result-emoji" id="resultEmoji">üéâ</div>
  <h2 id="resultTitle">Result</h2>
  <p id="resultText" style="font-size:clamp(16px, 1.8vw, 18px); color:#374151; margin:20px 0;"></p>
  <p style="margin-top:16px;"><strong>Final Diagnosis:</strong> <span style="color:#0f5132">Anorexia Nervosa ‚Äî Restrictive Type</span></p>
  <p style="margin-top:16px;"><strong>Essential Treatment Plan:</strong></p>
  <ul style="max-width:500px; margin:16px auto;">
    <li>Multidisciplinary therapy (psychology, psychiatry, nutrition)</li>
    <li>Safe weight restoration</li>
    <li>Family education and emotional support</li>
    <li>Management of body image distortion</li>
    <li>Monitoring of vital signs and complications</li>
  </ul>
  <button class="restart-btn" onclick="location.reload()">Play Again</button>
</div>

<!-- QUESTION MODAL -->
<div class="modal-overlay" id="questionModal">
  <div class="modal-box">
    <div class="modal-header">
      <span class="question-number" id="questionNumber">Level 1</span>
      <span id="modalQuestion">Question</span>
    </div>
    <div class="modal-options" id="modalOptions">
      <!-- Generated dynamically -->
    </div>
  </div>
</div>

<!-- INFO MODAL (clinical case) -->
<div class="info-modal" id="infoModal">
  <div class="info-content">
    <h3>Clinical Case: Mariana</h3>
    <p><strong>Doctor Chapatin's Case:</strong> Mariana, 16 years old.</p>
    <p><strong>Chief complaint:</strong> Marked weight loss over the past 5 months. Avoids eating with family, performs excessive exercise in secret.</p>
    <p><strong>Measurements:</strong> Weight: 38 kg; Height: 1.60 m (BMI 14.8 ‚Äî severely low).</p>
    <p><strong>Symptoms:</strong> Constant fatigue, dizziness, hair loss, amenorrhea for 3 months.</p>
    <p><strong>Physical examination:</strong> Cold and dry skin, bradycardia (HR 54 bpm), hypotension, severe body image distortion (perceives herself as "fat").</p>
    <p style="margin-top:16px; font-weight:600; color:#1a2744;">Doctor Chapatin needs your expertise to help Mariana recover through proper clinical diagnosis and treatment.</p>
    <div class="close-info" id="closeInfo">Close</div>
  </div>
</div>

<!-- ALERT MODAL (wrong answer) -->
<div class="alert-modal" id="alertModal">
  <div class="alert-box">
    <div class="alert-icon">‚ùå</div>
    <div class="alert-title">Wrong Answer!</div>
    <div class="alert-message">That's not correct. Don't give up!</div>
    <div class="lives-remaining">
      <span>‚ù§Ô∏è Lives Remaining: <span id="alertLivesCount">2</span></span>
    </div>
    <button class="alert-button" id="alertCloseBtn">Try Again üí™</button>
  </div>
</div>

<!-- Game over modal to replace browser alert -->
<div class="game-over-modal" id="gameOverModal">
  <div class="game-over-box">
    <div class="game-over-icon">üíî</div>
    <div class="game-over-title">GAME OVER</div>
    <div class="game-over-message">You lost all your lives!</div>
    <div class="game-over-stats">
      <div>Levels Completed: <strong id="gameOverLevels">0</strong>/7</div>
      <div style="margin-top:10px;">Time: <strong id="gameOverTime">00:00</strong></div>
    </div>
    <div class="game-over-message" style="font-size:clamp(16px, 2.2vw, 20px); margin-top:20px; color:#f39c12;">
      üîÑ Restarting from Level 1...
    </div>
    <button class="game-over-button" id="gameOverBtn">Continue üöÄ</button>
  </div>
</div>

<script>
/* ========= ALL 14 QUESTIONS POOL ========= */
const allQuestions = [
  { q: "What is the most concerning clinical finding in Mariana?",
    a: "Irregular sleep", b: "BMI of 14.8", c: "School stress", correct: "b" },
  { q: "What symptom is typical in eating disorders like anorexia?",
    a: "Increased appetite", b: "Body image distortion", c: "Severe abdominal pain", correct: "b" },
  { q: "The loss of menstruation in Mariana is called:",
    a: "Dysmenorrhea", b: "Amenorrhea", c: "Hypermenorrhea", correct: "b" },
  { q: "What is a physical sign associated with severe malnutrition?",
    a: "Cold and dry skin", b: "Fever", c: "Hypertension", correct: "a" },
  { q: "The behavior of excessive exercise in secret is considered:",
    a: "Compensatory behavior", b: "Respiratory problem", c: "Food allergy", correct: "a" },
  { q: "What value indicates bradycardia?",
    a: "HR < 60 bpm", b: "HR > 100 bpm", c: "HR = 80 bpm", correct: "a" },
  { q: "What complication can appear in extreme malnutrition?",
    a: "Increased calcium", b: "Cardiac arrhythmias", c: "Hyperglycemia", correct: "b" },
  { q: "Which professional is NOT essential in the treatment?",
    a: "Psychologist", b: "Nutritionist", c: "Industrial engineer", correct: "c" },
  { q: "What emotion could be influencing Mariana?",
    a: "Shame about her body", b: "Constant happiness", c: "Total indifference", correct: "a" },
  { q: "The mother asks why Mariana 'doesn't accept that she's thin'. This is called:",
    a: "Sensory denial", b: "Body image distortion", c: "Dehydration", correct: "b" },
  { q: "What would be the first nursing action?",
    a: "Criticize her weight", b: "Establish empathetic communication", c: "Force her to eat", correct: "b" },
  { q: "What test is useful to evaluate cardiac complications?",
    a: "Electrocardiogram (ECG)", b: "Chest X-ray", c: "Spirometry", correct: "a" },
  { q: "What type of feeding is recommended at the start of treatment?",
    a: "Rapid and forced feeding", b: "Gradual and supervised reintroduction", c: "Only liquids", correct: "b" },
  { q: "What should be included in the recovery plan?",
    a: "Psychological and nutritional therapy", b: "Suspend all foods", c: "Excessive exercise", correct: "a" }
];

/* ========= GAME STATE ========= */
let playerName = "";
let playerGender = "male";
let currentLevel = 0;
const totalLevels = 7;
let levelStatus = new Array(totalLevels).fill('locked');
levelStatus[0] = 'unlocked';
let score = 0;
let lives = 3;
let timerSeconds = 0;
let timerInterval = null;
let usedQuestions = [];
let selectedQuestions = [];

function selectRandomQuestions() {
  let available = [...Array(allQuestions.length).keys()];
  selectedQuestions = [];
  for(let i = 0; i < totalLevels; i++) {
    let randIdx = Math.floor(Math.random() * available.length);
    selectedQuestions.push(available[randIdx]);
    available.splice(randIdx, 1);
  }
  usedQuestions = [...selectedQuestions];
}

/* ========= ELEMENTS ========= */
const startScreen = document.getElementById('startScreen');
const gameScreen = document.getElementById('gameScreen');
const resultScreen = document.getElementById('resultScreen');
const playerNameInput = document.getElementById('playerNameInput');
const btnStart = document.getElementById('btnStart');
const playerNameDisplay = document.getElementById('playerNameDisplay');
const playerAvatar = document.getElementById('playerAvatar');
const nodesContainer = document.getElementById('nodesContainer');
const questionModal = document.getElementById('questionModal');
const modalQuestion = document.getElementById('modalQuestion');
const modalOptions = document.getElementById('modalOptions');
const questionNumber = document.getElementById('questionNumber');
const scoreDisplay = document.getElementById('scoreDisplay');
const progressFill = document.getElementById('progressFill');
const progressText = document.getElementById('progressText');
const infoBtnTop = document.getElementById('infoBtnTop');
const infoModal = document.getElementById('infoModal');
const closeInfo = document.getElementById('closeInfo');
const resultTitle = document.getElementById('resultTitle');
const resultText = document.getElementById('resultText');
const resultEmoji = document.getElementById('resultEmoji');
const livesDisplay = document.getElementById('livesDisplay');
const timerDisplay = document.getElementById('timerDisplay');
const doctorCharacter = document.getElementById('doctorCharacter');
const alertModal = document.getElementById('alertModal');
const alertLivesCount = document.getElementById('alertLivesCount');
const alertCloseBtn = document.getElementById('alertCloseBtn');
const gameOverModal = document.getElementById('gameOverModal');
const gameOverLevels = document.getElementById('gameOverLevels');
const gameOverTime = document.getElementById('gameOverTime');
const gameOverBtn = document.getElementById('gameOverBtn');

/* Gender selection functionality */
const genderMale = document.getElementById('genderMale');
const genderFemale = document.getElementById('genderFemale');
const radioMale = document.getElementById('radioMale');
const radioFemale = document.getElementById('radioFemale');

genderMale.addEventListener('click', () => {
  radioMale.checked = true;
  playerGender = 'male';
  genderMale.classList.add('selected');
  genderFemale.classList.remove('selected');
});

genderFemale.addEventListener('click', () => {
  radioFemale.checked = true;
  playerGender = 'female';
  genderFemale.classList.add('selected');
  genderMale.classList.remove('selected');
});

radioMale.addEventListener('change', () => {
  if(radioMale.checked) {
    playerGender = 'male';
    genderMale.classList.add('selected');
    genderFemale.classList.remove('selected');
  }
});

radioFemale.addEventListener('change', () => {
  if(radioFemale.checked) {
    playerGender = 'female';
    genderFemale.classList.add('selected');
    genderMale.classList.remove('selected');
  }
});

/* ========= TIMER FUNCTIONS ========= */
function startTimer() {
  timerSeconds = 0;
  timerInterval = setInterval(() => {
    timerSeconds++;
    updateTimerDisplay();
  }, 1000);
}

function stopTimer() {
  if(timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

/* Timer resets when game over */
function resetTimer() {
  stopTimer();
  timerSeconds = 0;
  updateTimerDisplay();
  startTimer();
}

function updateTimerDisplay() {
  const minutes = Math.floor(timerSeconds / 60);
  const seconds = timerSeconds % 60;
  timerDisplay.innerText = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
}

/* ========= START GAME ========= */
btnStart.addEventListener('click', ()=>{
  playerName = (playerNameInput.value || "Player").trim();
  playerNameDisplay.innerText = playerName;
  
  /* Set avatar based on selected gender */
  if(playerGender === 'female') {
    playerAvatar.innerText = 'üë©‚Äç‚öïÔ∏è';
  } else {
    playerAvatar.innerText = 'üë®‚Äç‚öïÔ∏è';
  }
  
  startScreen.style.display = 'none';
  gameScreen.style.display = 'flex';
  selectRandomQuestions();
  buildNodes();
  startTimer();
});

/* Build level nodes and position them along curved path */
function buildNodes(){
  nodesContainer.innerHTML = '';
  
  for(let i=0; i<totalLevels; i++){
    const node = document.createElement('div');
    node.className = 'level-node ' + levelStatus[i];
    node.innerHTML = `<div style="font-size:clamp(18px, 2.5vw, 24px);">${String(i+1).padStart(2,'0')}</div><div class="level-label">Level ${i+1}</div>`;
    node.dataset.level = i;
    
    if(levelStatus[i] === 'unlocked'){
      node.addEventListener('click', ()=> openQuestion(i));
    }
    nodesContainer.appendChild(node);
  }
  
  updateDoctorPosition();
}

/* Update Doctor Chapatin position along the path */
function updateDoctorPosition(){
  const completedCount = levelStatus.filter(s => s === 'completed').length;
  const currentLevelIndex = Math.min(completedCount, totalLevels - 1);
  
  // Find the current level node
  const nodes = nodesContainer.querySelectorAll('.level-node');
  if(nodes[currentLevelIndex]){
    const nodeRect = nodes[currentLevelIndex].getBoundingClientRect();
    const containerRect = nodesContainer.getBoundingClientRect();
    
    // Position relative to container
    const leftPercent = ((nodeRect.left - containerRect.left) / containerRect.width) * 100;
    const topPercent = ((nodeRect.top - containerRect.top + nodeRect.height/2) / containerRect.height) * 100;
    
    doctorCharacter.style.left = `calc(${leftPercent}% - 60px)`; // Adjust -60px to center the character visually
    doctorCharacter.style.top = `${topPercent}%`;
    doctorCharacter.style.transform = 'translateY(-50%)'; // Keep character vertically centered on its new top position
  } else {
    // Default position at start if no nodes or start is not completed
    doctorCharacter.style.left = '2%';
    doctorCharacter.style.top = '50%';
    doctorCharacter.style.transform = 'translateY(-50%)';
  }
}

/* ========= OPEN QUESTION MODAL ========= */
function openQuestion(level){
  if(levelStatus[level] !== 'unlocked') return;
  currentLevel = level;
  const qIdx = selectedQuestions[level];
  const q = allQuestions[qIdx];
  questionNumber.innerText = `Level ${level + 1}`;
  modalQuestion.innerText = q.q;
  modalOptions.innerHTML = '';
  ['a','b','c'].forEach(letter => {
    const btn = document.createElement('div');
    btn.className = 'option-btn';
    btn.innerHTML = `
      <div class="opt-letter">${letter.toUpperCase()}</div>
      <div class="opt-text">${q[letter]}</div>
    `;
    btn.addEventListener('click', ()=> handleAnswer(letter, btn));
    modalOptions.appendChild(btn);
  });
  questionModal.classList.add('active');
}

/* ========= HANDLE ANSWER ========= */
function handleAnswer(letter, btnElement){
  const qIdx = selectedQuestions[currentLevel];
  const q = allQuestions[qIdx];
  const correct = q.correct;
  
  if(letter === correct){
    btnElement.classList.add('correct');
    createParticles('‚ú®', btnElement);
    score++;
    updateScore();
    
    setTimeout(()=>{
      levelStatus[currentLevel] = 'completed';
      if(currentLevel + 1 < totalLevels){
        levelStatus[currentLevel + 1] = 'unlocked';
      }
      questionModal.classList.remove('active');
      buildNodes();
      updateProgress();
      updateDoctorPosition();
      
      if(levelStatus.every(s => s === 'completed')){
        finishGame();
      }
    }, 900);
  } else {
    btnElement.classList.add('incorrect');
    createParticles('‚ùå', btnElement);
    
    lives--;
    livesDisplay.innerText = lives;
    
    setTimeout(() => {
      questionModal.classList.remove('active');
      
      if(lives <= 0) {
        showGameOverModal();
      } else {
        loadNewQuestion();
      }
    }, 700);
  }
}

/* Load new unused question when answer is wrong */
function loadNewQuestion() {
  let availableQuestions = [];
  for(let i = 0; i < allQuestions.length; i++) {
    if(!usedQuestions.includes(i)) {
      availableQuestions.push(i);
    }
  }
  
  if(availableQuestions.length === 0) {
    usedQuestions = [...selectedQuestions];
    availableQuestions = [];
    for(let i = 0; i < allQuestions.length; i++) {
      if(!usedQuestions.includes(i)) {
        availableQuestions.push(i);
      }
    }
  }
  
  if(availableQuestions.length > 0) {
    const randomIdx = Math.floor(Math.random() * availableQuestions.length);
    const newQuestionIdx = availableQuestions[randomIdx];
    selectedQuestions[currentLevel] = newQuestionIdx;
    usedQuestions.push(newQuestionIdx);
  }
  
  alertLivesCount.innerText = lives;
  alertModal.classList.add('active');
}

alertCloseBtn.addEventListener('click', () => {
  alertModal.classList.remove('active');
  setTimeout(() => {
    openQuestion(currentLevel);
  }, 300);
});

alertModal.addEventListener('click', (e) => {
  if(e.target === alertModal) {
    alertModal.classList.remove('active');
    setTimeout(() => {
      openQuestion(currentLevel);
    }, 300);
  }
});

/* Game over modal instead of browser alert */
function showGameOverModal() {
  const completedCount = levelStatus.filter(s => s === 'completed').length;
  gameOverLevels.innerText = completedCount;
  gameOverTime.innerText = timerDisplay.innerText;
  gameOverModal.classList.add('active');
}

gameOverBtn.addEventListener('click', () => {
  gameOverModal.classList.remove('active');
  resetToLevel1();
});

gameOverModal.addEventListener('click', (e) => {
  if(e.target === gameOverModal) {
    gameOverModal.classList.remove('active');
    resetToLevel1();
  }
});

/* Reset to level 1 and restart timer */
function resetToLevel1() {
  lives = 3;
  livesDisplay.innerText = lives;
  score = 0;
  updateScore();
  currentLevel = 0;
  levelStatus = new Array(totalLevels).fill('locked');
  levelStatus[0] = 'unlocked';
  selectRandomQuestions();
  buildNodes();
  updateProgress();
  resetTimer();
  updateDoctorPosition();
}

function createParticles(emoji, element){
  const rect = element.getBoundingClientRect();
  for(let i=0; i<10; i++){
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.innerText = emoji;
    particle.style.left = (rect.left + rect.width/2 + (Math.random()-0.5)*80) + 'px';
    particle.style.top = (rect.top + rect.height/2) + 'px';
    document.body.appendChild(particle);
    setTimeout(()=> particle.remove(), 1800);
  }
}

function updateScore(){
  scoreDisplay.innerText = `${score}/7`;
}

function updateProgress(){
  const completedCount = levelStatus.filter(s => s === 'completed').length;
  const percent = (completedCount / totalLevels) * 100;
  progressFill.style.width = percent + '%';
  progressText.innerText = `${completedCount}/${totalLevels}`;
}

infoBtnTop.addEventListener('click', ()=>{
  infoModal.classList.add('active');
});
closeInfo.addEventListener('click', ()=>{
  infoModal.classList.remove('active');
});

infoModal.addEventListener('click', (e)=>{
  if(e.target === infoModal){
    infoModal.classList.remove('active');
  }
});

questionModal.addEventListener('click', (e)=>{
  if(e.target === questionModal){
    questionModal.classList.remove('active');
  }
});

function finishGame(){
  stopTimer();
  gameScreen.style.display = 'none';
  resultScreen.classList.add('active');
  const rescued = score >= 7;
  
  if(rescued){
    resultEmoji.innerText = 'üéâ';
    resultTitle.innerText = `Excellent, ${playerName}!`;
    resultText.innerHTML = `You helped Doctor Chapatin complete all levels!<br><strong>Score:</strong> ${score}/7<br><strong>Time:</strong> ${timerDisplay.innerText}<br><span style="color:#0f5132">You have correctly identified the diagnosis and comprehensive treatment plan.</span>`;
  } else {
    resultEmoji.innerText = 'üí™';
    resultTitle.innerText = `Good try, ${playerName}`;
    resultText.innerHTML = `You completed the game with Doctor Chapatin.<br><strong>Score:</strong> ${score}/7<br><strong>Time:</strong> ${timerDisplay.innerText}<br><span style="color:#804040">Keep studying to improve your clinical knowledge.</span>`;
  }
}
</script>

</body>
</html>
